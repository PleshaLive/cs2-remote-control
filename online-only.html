<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>CS2 Online Controller</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(45deg, #4ecdc4, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .status {
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgba(76, 205, 196, 0.1);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid #4ecdc4;
            margin-bottom: 20px;
        }

        .status i {
            color: #4ecdc4;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .button-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .button-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .button-card:hover::before {
            left: 100%;
        }

        .button-card:hover {
            transform: translateY(-5px);
            border-color: #4ecdc4;
            box-shadow: 0 10px 25px rgba(76, 205, 196, 0.2);
        }

        .button-card.active {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(76, 205, 196, 0.4);
            animation: buttonPulse 2s ease-in-out;
        }

        @keyframes buttonPulse {
            0%, 100% { transform: scale(1.05); }
            50% { transform: scale(1.1); }
        }

        .button-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
        }

        .button-label {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 5px;
        }

        .button-state {
            font-size: 0.8rem;
            opacity: 0.8;
            background: rgba(0,0,0,0.3);
            padding: 3px 8px;
            border-radius: 10px;
            margin-top: 5px;
        }

        .log-container {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            padding: 5px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-success { color: #4ecdc4; }
        .log-info { color: #667eea; }
        .log-warning { color: #ffa726; }
        .log-error { color: #ef5350; }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .button-card {
                min-height: 100px;
                padding: 15px;
                margin: 5px;
            }

            .button-card:hover {
                transform: none;
            }

            .button-card:active,
            .button-card.pressed {
                transform: scale(0.95);
                transition: transform 0.1s ease;
            }

            .buttons-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 10px;
            }

            .button-icon {
                font-size: 1.5rem;
            }

            .button-label {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-gamepad"></i> CS2 Online Controller</h1>
        <div class="status">
            <i class="fas fa-circle-notch fa-spin"></i>
            <span>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>
        </div>
    </div>

    <div class="buttons-grid" id="buttonsGrid">
        <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
    </div>

    <div class="log-container">
        <h3><i class="fas fa-list"></i> –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π</h3>
        <div id="logContainer">
            <!-- –õ–æ–≥-–∑–∞–ø–∏—Å–∏ -->
        </div>
    </div>

    <script>
        class OnlineController {
            constructor() {
                this.buttons = {};
                this.logs = [];
                this.init();
            }

            async init() {
                this.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–Ω–ª–∞–π–Ω –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞...', 'info');
                await this.loadDefaultButtons();
                this.createButtonsGrid();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ GSI Companion
                await this.checkGSIConnection();
                
                this.log('‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                if (/Mobi|Android/i.test(navigator.userAgent)) {
                    this.log('üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ', 'info');
                }
                
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥)
                setInterval(() => this.checkGSIConnection(), 10000);
            }

            async checkGSIConnection() {
                try {
                    const response = await fetch('http://127.0.0.1:2828/api/local-buttons', {
                        method: 'GET',
                        timeout: 2000
                    });
                    
                    if (response.ok) {
                        this.setConnectionStatus(true);
                        return true;
                    } else {
                        this.setConnectionStatus(false);
                        return false;
                    }
                } catch (error) {
                    this.setConnectionStatus(false);
                    return false;
                }
            }

            async loadDefaultButtons() {
                this.buttons = {
                    'bomb_planted': {
                        label: '–ë–æ–º–±–∞ –∑–∞–ª–æ–∂–µ–Ω–∞',
                        icon: 'fas fa-bomb',
                        state: '-',
                        timestamp: 0
                    },
                    'bomb_defused': {
                        label: '–ë–æ–º–±–∞ –æ–±–µ–∑–≤—Ä–µ–∂–µ–Ω–∞',
                        icon: 'fas fa-shield-alt',
                        state: '-',
                        timestamp: 0
                    },
                    'round_start': {
                        label: '–ù–∞—á–∞–ª–æ —Ä–∞—É–Ω–¥–∞',
                        icon: 'fas fa-play',
                        state: '-',
                        timestamp: 0
                    },
                    'round_end': {
                        label: '–ö–æ–Ω–µ—Ü —Ä–∞—É–Ω–¥–∞',
                        icon: 'fas fa-stop',
                        state: '-',
                        timestamp: 0
                    },
                    'clutch_mode': {
                        label: '–ö–ª–∞—Ç—á —Ä–µ–∂–∏–º',
                        icon: 'fas fa-crosshairs',
                        state: '-',
                        timestamp: 0
                    },
                    'ace_moment': {
                        label: '–≠–π—Å –º–æ–º–µ–Ω—Ç',
                        icon: 'fas fa-crown',
                        state: '-',
                        timestamp: 0
                    },
                    'headshot': {
                        label: '–•–µ–¥—à–æ—Ç',
                        icon: 'fas fa-bullseye',
                        state: '-',
                        timestamp: 0
                    },
                    'multikill': {
                        label: '–ú—É–ª—å—Ç–∏–∫–∏–ª–ª',
                        icon: 'fas fa-skull-crossbones',
                        state: '-',
                        timestamp: 0
                    }
                };
            }

            createButtonsGrid() {
                const grid = document.getElementById('buttonsGrid');
                grid.innerHTML = '';

                Object.entries(this.buttons).forEach(([key, button]) => {
                    const buttonCard = document.createElement('div');
                    buttonCard.className = 'button-card';
                    buttonCard.id = `button-${key}`;
                    
                    buttonCard.innerHTML = `
                        <i class="${button.icon} button-icon"></i>
                        <div class="button-label">${button.label}</div>
                        <div class="button-state">${button.state}</div>
                    `;

                    // Click/Touch events
                    buttonCard.onclick = () => this.activateButton(key);
                    
                    // Mobile touch support
                    buttonCard.ontouchstart = (e) => {
                        buttonCard.style.transform = 'scale(0.95)';
                        buttonCard.style.transition = 'transform 0.1s';
                    };

                    buttonCard.ontouchend = (e) => {
                        buttonCard.style.transform = '';
                        this.activateButton(key);
                        e.preventDefault();
                    };

                    grid.appendChild(buttonCard);
                });
            }

            async activateButton(buttonKey) {
                if (!this.buttons[buttonKey]) return;

                const button = this.buttons[buttonKey];
                button.state = '+';
                button.timestamp = Date.now();

                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–∞—Ü–∏—è
                const buttonElement = document.getElementById(`button-${buttonKey}`);
                if (buttonElement) {
                    buttonElement.classList.add('active');
                    buttonElement.querySelector('.button-state').textContent = '+';
                }

                this.log(`üéØ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞: ${button.label}`, 'success');

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ API
                await this.updateAPI(buttonKey, '+');

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(async () => {
                    button.state = '-';
                    button.timestamp = Date.now();
                    if (buttonElement) {
                        buttonElement.classList.remove('active');
                        buttonElement.querySelector('.button-state').textContent = '-';
                    }
                    await this.updateAPI(buttonKey, '-');
                    this.log(`‚èπÔ∏è –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞: ${button.label}`, 'info');
                }, 2000);
            }

            async updateAPI(buttonKey, state) {
                const apiData = {
                    buttonKey: buttonKey,
                    state: state,
                    timestamp: Date.now(),
                    label: this.buttons[buttonKey]?.label
                };

                // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç)
                localStorage.setItem(`cs2-button-${buttonKey}`, JSON.stringify(apiData));

                // –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ GSI Companion (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
                try {
                    const response = await fetch('http://127.0.0.1:2828/api/button-press', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(apiData),
                        timeout: 3000 // 3 —Å–µ–∫—É–Ω–¥—ã —Ç–∞–π–º–∞—É—Ç
                    });

                    if (response.ok) {
                        this.log(`üì° –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ GSI: ${buttonKey} -> ${state}`, 'success');
                        this.setConnectionStatus(true);
                    } else {
                        this.log(`‚ö†Ô∏è GSI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∫–æ–¥: ${response.status})`, 'warning');
                        this.setConnectionStatus(false);
                    }
                } catch (error) {
                    // GSI Companion –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞–±–æ—Ç–∞–µ–º –æ—Ñ—Ñ–ª–∞–π–Ω
                    this.log(`üíæ –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º: ${buttonKey} —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 'info');
                    this.setConnectionStatus(false);
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º JSON –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏)
                if (state === '+') {
                    this.showUpdateDialog(buttonKey, state);
                }
            }

            setConnectionStatus(isOnline) {
                const statusEl = document.querySelector('.status span');
                const iconEl = document.querySelector('.status i');
                
                if (isOnline) {
                    statusEl.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω –∫ GSI Companion';
                    iconEl.className = 'fas fa-wifi';
                    iconEl.style.color = '#4ecdc4';
                } else {
                    statusEl.textContent = '–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º (GSI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)';
                    iconEl.className = 'fas fa-wifi-slash';
                    iconEl.style.color = '#ffa726';
                }
            }

            showUpdateDialog(buttonKey, state) {
                // –°–æ–∑–¥–∞–µ–º JSON –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è GitHub Pages API
                const updateData = {
                    lastUpdate: Date.now(),
                    button: buttonKey,
                    state: state,
                    timestamp: Date.now(),
                    coordinates: this.getButtonCoordinates(buttonKey)
                };

                console.log('üìã JSON –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è API:', JSON.stringify(updateData, null, 2));
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ GSI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                if (state === '+') {
                    const existingDialog = document.getElementById('update-dialog');
                    if (existingDialog) existingDialog.remove();

                    const dialog = document.createElement('div');
                    dialog.id = 'update-dialog';
                    dialog.style.cssText = `
                        position: fixed; top: 20px; right: 20px;
                        background: linear-gradient(135deg, #1a1a2e, #16213e);
                        color: white; padding: 15px; border-radius: 10px;
                        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                        z-index: 10000; max-width: 300px;
                        border: 1px solid #4ecdc4;
                    `;

                    const buttonInfo = this.buttons[buttonKey];
                    const coords = this.getButtonCoordinates(buttonKey);
                    
                    dialog.innerHTML = `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <i class="${buttonInfo.icon}" style="margin-right: 8px; color: #4ecdc4;"></i>
                            <strong>${buttonInfo.label}</strong>
                        </div>
                        <div style="font-size: 12px; opacity: 0.8;">
                            –ö–Ω–æ–ø–∫–∞: ${buttonKey}<br>
                            Stream Deck: ${coords.page}/${coords.row}/${coords.col}<br>
                            –í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}
                        </div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #333; font-size: 11px;">
                            ÔøΩ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ<br>
                            ÔøΩüìã JSON –≤—ã–≤–µ–¥–µ–Ω –≤ –∫–æ–Ω—Å–æ–ª—å
                        </div>
                    `;

                    document.body.appendChild(dialog);

                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        if (document.getElementById('update-dialog')) {
                            dialog.remove();
                        }
                    }, 4000);
                }
            }

            getButtonCoordinates(buttonKey) {
                const mapping = {
                    'bomb_planted': { page: 1, row: 1, col: 1 },
                    'bomb_defused': { page: 1, row: 1, col: 2 },
                    'round_start': { page: 1, row: 1, col: 3 },
                    'round_end': { page: 1, row: 1, col: 4 },
                    'clutch_mode': { page: 1, row: 2, col: 1 },
                    'ace_moment': { page: 1, row: 2, col: 2 },
                    'headshot': { page: 1, row: 2, col: 3 },
                    'multikill': { page: 1, row: 2, col: 4 }
                };
                return mapping[buttonKey] || { page: 1, row: 1, col: 1 };
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = {
                    timestamp,
                    message,
                    type
                };
                
                this.logs.unshift(logEntry);
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤
                if (this.logs.length > 50) {
                    this.logs = this.logs.slice(0, 50);
                }
                
                this.updateLogDisplay();
            }

            updateLogDisplay() {
                const container = document.getElementById('logContainer');
                container.innerHTML = this.logs.map(log => 
                    `<div class="log-entry log-${log.type}">
                        [${log.timestamp}] ${log.message}
                    </div>`
                ).join('');
                
                // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏
                container.scrollTop = 0;
            }
        }

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑—É–º–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
        if (/Mobi|Android/i.test(navigator.userAgent)) {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ multi-touch –∑—É–º–∞
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ double-tap –∑—É–º–∞
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
        const controller = new OnlineController();
    </script>
</body>
</html>
