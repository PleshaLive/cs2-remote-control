<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile Test - CS2 Controller</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
            margin: 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            padding: 20px;
            border-radius: 15px;
            color: white;
            font-size: 18px;
            margin: 10px;
            cursor: pointer;
            min-height: 80px;
            width: calc(50% - 20px);
            display: inline-block;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .test-button:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }
        
        .log {
            background: #2c2c2c;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #444;
        }
        
        .status {
            text-align: center;
            padding: 15px;
            background: #0f3460;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="status">
        <h2>üì± –¢–µ—Å—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞</h2>
        <div id="device-info"></div>
    </div>

    <div>
        <button class="test-button" onclick="testButton('bomb_planted')">
            üí£ –ë–æ–º–±–∞ –∑–∞–ª–æ–∂–µ–Ω–∞
        </button>
        <button class="test-button" onclick="testButton('round_start')">
            üéØ –ù–∞—á–∞–ª–æ —Ä–∞—É–Ω–¥–∞
        </button>
        <button class="test-button" onclick="testButton('clutch_mode')">
            ‚ö° –ö–ª–∞—Ç—á —Ä–µ–∂–∏–º
        </button>
        <button class="test-button" onclick="testButton('ace_moment')">
            üëë –≠–π—Å –º–æ–º–µ–Ω—Ç
        </button>
    </div>

    <div class="log">
        <h3>üìã –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π:</h3>
        <div id="log-container"></div>
    </div>

    <script>
        let logEntries = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.unshift(entry);
            
            document.getElementById('log-container').innerHTML = 
                logEntries.map(entry => `<div class="log-entry">${entry}</div>`).join('');
        }

        function testButton(buttonId) {
            log(`üéØ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞: ${buttonId}`);
            
            // –°–∏–º—É–ª—è—Ü–∏—è API –≤—ã–∑–æ–≤–∞
            const apiData = {
                buttonKey: buttonId,
                state: '+',
                timestamp: Date.now()
            };
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
            fetch('http://127.0.0.1:2828/api/button-press', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(apiData)
            })
            .then(response => {
                if (response.ok) {
                    log(`‚úÖ API –≤—ã–∑–æ–≤ —É—Å–ø–µ—à–µ–Ω –¥–ª—è ${buttonId}`);
                    return response.json();
                } else {
                    log(`‚ö†Ô∏è API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (–∫–æ–¥: ${response.status})`);
                }
            })
            .then(data => {
                if (data) {
                    log(`üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ${JSON.stringify(data)}`);
                }
            })
            .catch(error => {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
                log(`üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ: ${buttonId}`);
            });

            // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            localStorage.setItem(`cs2-button-${buttonId}`, JSON.stringify(apiData));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const deviceInfo = document.getElementById('device-info');
            const isMobile = /Mobi|Android/i.test(navigator.userAgent);
            const touchSupport = 'ontouchstart' in window;
            
            deviceInfo.innerHTML = `
                –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${isMobile ? '–ú–æ–±–∏–ª—å–Ω–æ–µ' : '–î–µ—Å–∫—Ç–æ–ø'}<br>
                Touch –ø–æ–¥–¥–µ—Ä–∂–∫–∞: ${touchSupport ? '–î–∞' : '–ù–µ—Ç'}<br>
                User Agent: ${navigator.userAgent.substring(0, 50)}...
            `;
            
            log(`üöÄ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω (${isMobile ? '–º–æ–±–∏–ª—å–Ω—ã–π' : '–¥–µ—Å–∫—Ç–æ–ø'} —Ä–µ–∂–∏–º)`);
        });

        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑—É–º–∞
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
                e.preventDefault();
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
